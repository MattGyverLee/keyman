#!/bin/sh

set -e

case "$1" in

  remove)
    # Restart IBus if it is running
    ! ibuspid=`ps -C ibus-daemon -o pid=|head -n 1`

    if [ "x$ibuspid" != "x" ]; then
      # check for gnome-shell as it works differently
      ! gspid=`ps -C gnome-shell -o pid=|head -n 1`
      if [ "x$gspid" != "x" ]; then
        # gnome-shell has multiple ibus-daemon processes and needs exit instead of restart
        ibususer=`ps -C ibus-daemon -o user=|grep -v gdm|uniq`
        if [ "x$ibususer" != "x" ]; then
          sudo -H -u "$ibususer" ibus exit || true
        fi
      else
        ibususer=`ps -C ibus-daemon -o user=|uniq`
        if [ "x$ibususer" != "x" ]; then
          sudo -H -u "$ibususer" ibus restart || true
        fi
      fi
    fi
  ;;

  purge|upgrade|failed-upgrade|abort-install|abort-upgrade|disappear)
    exit 0
  ;;

  *)
    echo "postrm called with unknown argument \`$1'" >&2
    exit 1
  ;;

esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
